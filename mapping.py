# import json
#
# # ----------- 1. 증상 카테고리별 증상 리스트 -----------
#
# category_mapping = {
#     "뼈": ["뼈_건강", "골다공증_예방", "뼈_통증", "성장기", "골절"],
#     "근골격": ["근육_기능", "근육_약화", "근육_경련", "부정맥", "생리통", "관절통", "관절염"],
#     "뇌": ["기억력", "집중력_향상", "신경_발달", "인지력_저하", "알츠하이머"],
#     "눈": ["눈떨림", "시력저하", "시력_저하", "안구건조", "야맹증"],
#     "손떨림": ["파킨슨_예방", "신경_이상"],
#     "신경": ["우울증", "신경통", "에너지_대사", "만성_피로", "말초신경손상"],
#     "정신건강": ["불안", "불면", "기분변화", "공황"],
#     "혈액": ["빈혈", "창백_피부", "두통", "호흡곤란", "피"],
#     "순환기": ["혈액_순환", "심혈관", "고혈압", "고지혈증"],
#     "갑상선": ["갑상선_기능", "체중", "추위", "민감성", "피로"],
#     "호르몬": ["생리", "월경_주기", "생식", "정자_건강", "PMS"],
#     "면역력": ["면역력_저하", "감염_저항성", "상처_회복"],
#     "항산화": ["항산화_작용", "세포_손상", "노화"],
#     "피부": ["피부_트러블", "피부_건조", "피부_노화", "피부_탄력", "여드름", "기미"],
#     "모발": ["모발_건강", "탈모", "머리카락_가늘어짐"],
#     "손발톱": ["점막_건조", "입술_갈라짐", "손톱", "손톱_갈라짐"],
#     "수면": ["수면장애", "불면", "수면_질"],
#     "스트레스": ["스트레스_완화", "우울감", "정신적_피로", "피로"],
#     "임신": ["산모_건강", "임신_필수_미네랄", "비타민", "입덧", "태아_기형_예방"],
#     "태아": ["태아_발달", "신경_발달", "두뇌_발달"],
#     "소화": ["소화불량", "위산과다", "장_건강", "변비"]
# }
#
# # ----------- 2. 카테고리별 추천 성분 -----------
#
# category_to_supplement = {
#     "뼈": ["칼슘", "비타민_D", "비타민_K2", "마그네슘", "보론"],
#     "근골격": ["마그네슘", "비타민_D", "오메가3", "글루코사민", "MSM"],
#     "뇌": ["콜린", "비타민_B군", "오메가3", "포스파티딜세린", "아세틸-L-카르니틴"],
#     "눈": ["마그네슘", "비타민_A", "루테인", "제아잔틴", "오메가3"],
#     "손떨림": ["비타민_B1", "비타민_B6", "마그네슘"],
#     "신경": ["비타민_B군", "요오드", "오메가3", "알파_리포산", "마그네슘"],
#     "정신건강": ["마그네슘", "L-테아닌", "아슈와간다", "비타민_D", "오메가3"],
#     "혈액": ["철분", "비타민_B12", "엽산", "비타민_C", "구리"],
#     "순환기": ["코엔자임Q10", "오메가3", "마그네슘", "비타민_E", "폴리코사놀"],
#     "갑상선": ["요오드", "셀레늄", "아연", "비타민_D"],
#     "호르몬": ["비타민_B6", "아연", "감마_리놀렌산(GLA)", "비타민_E"],
#     "면역력": ["아연", "비타민_C", "비타민_D", "셀레늄", "프로폴리스"],
#     "항산화": ["비타민_E", "셀레늄", "비타민_C", "코엔자임Q10"],
#     "피부": ["비오틴", "콜라겐", "비타민_A", "비타민_C", "아연", "MSM"],
#     "모발": ["비오틴", "아연", "L-시스틴", "MSM", "비타민_D"],
#     "손발톱": ["비오틴", "아연", "실리카", "비타민_B군"],
#     "수면": ["마그네슘", "멜라토닌", "L-테아닌", "글리신"],
#     "스트레스": ["마그네슘", "비타민_B군", "아슈와간다", "L-테아닌"],
#     "임신": ["엽산", "철분", "비타민_D", "비타민_B6", "DHA"],
#     "태아": ["엽산", "오메가3", "콜린", "비타민_D"],
#     "소화": ["유산균", "아연_카르노신", "글루타민", "소화효소"],
#     "저혈압": ["비타민_E", "비타민_B12", "마그네슘"],
#     "고혈압": ["칼륨", "마그네슘", "칼슘", "오메가3"]
# }
#
# # ----------- 3. 피해야 할 성분 -----------
#
# category_to_avoid = {
#     "모발": ["판토텐산"],
#     "수면": ["카페인"],
#     "피부": ["설탕", "트랜스지방"],
#     "신경": ["카페인", "알코올"],
#     "스트레스": ["카페인", "설탕"],
#     "소화": ["지방", "알코올", "카페인"],
#     "심혈관": ["나트륨", "트랜스지방"],
#     "갑상선": ["콩", "브로콜리"],
#     "우울증": ["알코올", "설탕"]
# }
#
# # ----------- 4. 증상 → 추천 성분 및 피해야 할 성분 매핑 -----------
#
# symptom_to_supplements = {}
# symptom_to_avoid = {}
#
# for category, symptoms in category_mapping.items():
#     supps = category_to_supplement.get(category, [])
#     avoids = category_to_avoid.get(category, [])
#     for symptom in symptoms:
#         symptom_to_supplements[symptom] = supps
#         symptom_to_avoid[symptom] = avoids
#
# # ----------- 5. 저장 -----------
#
# with open('./knowledge/mapping.json', 'w', encoding='utf-8') as f:
#     json.dump(symptom_to_supplements, f, ensure_ascii=False, indent=2)
#
# with open('./knowledge/avoid_mapping.json', 'w', encoding='utf-8') as f:
#     json.dump(symptom_to_avoid, f, ensure_ascii=False, indent=2)
#
# print("✅ mapping.json / avoid_mapping.json 생성 완료!")

import json
import pandas as pd
from collections import defaultdict

# ----------- 1. 리뷰 기반 증상 추적 -----------
df = pd.read_csv('./cleaned_data/cleaned_supplements.csv')

# 증상 키워드 리스트 (확장 가능)
symptom_keywords = {
    "두통": ["두통", "머리아픔", "편두통"],
    "눈": ["눈피로", "시력", "눈물", "안구건조", "시력저하", "눈이 침침"],
    "피로": ["피로", "무기력", "기운없음", "만성피로", "힘이 없음"],
    "불면": ["잠안옴", "불면", "수면장애", "잠이 안 옴", "깊게 못 잠"],
    "소화": ["소화불량", "속이 더부룩", "소화 안됨", "속쓰림"],
    "관절": ["무릎통증", "관절통", "관절염", "관절이 아픔"],
    "피부": ["피부트러블", "여드름", "건조함", "피부가려움", "기미"],
    "우울": ["우울", "우울증", "무기력", "기분이 가라앉음"],
    "면역": ["면역력 저하", "감기 자주", "자주 아픔", "병에 잘 걸림"],
    "눈떨림": ["눈떨림", "눈이 떨림", "눈 밑이 떨림"]
}

# 제품별 리뷰 기반 증상 매핑
df = df[df['review'].notnull() & df['product'].notnull()]
product_symptom_map = defaultdict(set)

for _, row in df.iterrows():
    review = str(row['review'])
    product = row['product']
    for symptom, keywords in symptom_keywords.items():
        if any(kw in review for kw in keywords):
            product_symptom_map[product].add(symptom)

# 저장
with open('./knowledge/product_symptom.json', 'w', encoding='utf-8') as f:
    json.dump({k: list(v) for k, v in product_symptom_map.items()}, f, ensure_ascii=False, indent=2)

print("✅ 리뷰 기반 product_symptom.json 생성 완료! (mapping 영향 제거)")
